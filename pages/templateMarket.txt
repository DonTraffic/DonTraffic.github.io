<template>
    <div id="PrintDonTraffic">
        <main class="wrapper">
            <section class="custom block" v-show="activeCatalogItem">
                <h2 class="block__title">Настройте изделие</h2>

                <div class="custom__container">
                    <div class="custom__menu">
                        <div 
                            class="custom__menu-slider slider" 
                            id="custom-menu-slider"
                            items-count='{"0":2.2, "450":1.2, "650":1.8, "950":2.2, "1150":3.2}' 
                            gap='16'
                            padding="16"
                        >
                            <div class="slider__line-wrap">
                                <div class="slider__line">
                                    <div 
                                        class="custom__menu-slider-item slider__line-item" 
                                        v-for="(layer, key) in canvas.layers" :key="layer"
                                    >
                                        <label class="custom__menu-slider-item-label">
                                            <img 
                                                class="custom__menu-slider-item-image"
                                                :src="layer.toDataURL()" 
                                                :alt="`image-item-custom-${key}`"
                                            >

                                            <input
                                                class="custom__menu-slider-item-input"
                                                type="file"
                                                @change="(e) => updateUpload(e, key)"
                                            >
                                        </label>
                                    </div>

                                    <div class="custom__menu-slider-item slider__line-item">
                                        <label class="custom__menu-slider-item-label">
                                            <svg class="custom__menu-slider-item-svg">
                                                <use xlink:href="@/assets/svg/sprite.svg#image-default"></use>
                                            </svg>

                                            <input
                                                class="custom__menu-slider-item-input"
                                                type="file"
                                                @change="(e) => updateUpload(e, canvas.layers.canvasList.length)"
                                            >
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- <label class="custom__menu-label" v-if="catalogItems[activeCatalogItem]">
                            Ссылку на свой продукт -
                            <input 
                                class="custom__menu-label-input" 
                                type="text"
                                placeholder="ссылка или название"
                                v-model="catalogItems[activeCatalogItem].productUrl"
                            >
                        </label>

                        <label class="custom__menu-label">
                            Коментарий к заказу -
                            <input 
                                class="custom__menu-label-input" 
                                type="text"
                                placeholder="выложи душу"
                                v-model="catalogItems[activeCatalogItem].message"
                            >
                        </label> -->

                        <!-- <button class="custom__menu-btn" v-on:click="convertToBlackAndWhite()">Заказать</button> -->
                    </div>

                    <div class="custom__separator"></div>

                    <div class="custom__redactor">
                        <div class="custom__redactor-layers" :class="{'custom__redactor-layers--show': canvas.layers.show}">
                            <div 
                                class="custom__redactor-layers-button"
                                @click="canvas.layers.show = !canvas.layers.show"
                            >Слои</div>

                            <div class="custom__redactor-layers-items">
                                <div 
                                    class="custom__redactor-layers-item"
                                    v-for="(item, index) in canvas.layers" 
                                    :key="`${item}-${index}`"
                                    :class="{'custom__redactor-layers-item--active': canvas.layers.canvasActive == index}"
                                >
                                    <input
                                        class="custom__redactor-layers-item-text"
                                        @click="this.canvas.layers.canvasActive = index; updateCanvas()"
                                        v-model="item.name"
                                        type="text"
                                    >

                                    <div class="custom__redactor-layers-item-arrows">
                                        <button 
                                            class="custom__redactor-layers-item-arrow custom__redactor-layers-item-arrow--top"
                                            v-if="index != 0 && index != 1"
                                            @click="moveLayers(Number(index), Number(index)-1)"
                                        >
                                            <svg class="custom__redactor-layers-item-arrow-svg">
                                                <use xlink:href="@/assets/svg/sprite.svg#arrow"></use>
                                            </svg>
                                        </button>

                                        <button 
                                            class="custom__redactor-layers-item-arrow custom__redactor-layers-item-arrow--bottom"
                                            v-if="index != 0 && Number(index)+1 != this.canvas.layers.canvasList.length"
                                            @click="moveLayers(Number(index), Number(index)+1)"
                                        >
                                            <svg class="custom__redactor-layers-item-arrow-svg">
                                                <use xlink:href="@/assets/svg/sprite.svg#arrow"></use>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="custom__redactor-tools" :class="{'custom__redactor-tools--show': canvas.toolsShow}" v-if="canvas.linkCanvasActive">
                            <div 
                                class="custom__redactor-tools-button"
                                @click="canvas.toolsShow = !canvas.toolsShow"
                            >Инструменты</div>

                            <div class="custom__redactor-tools-items">
                                <div class="custom__redactor-tools-item">
                                    <p class="custom__redactor-tools-item-text">Повернуть</p>
                                    <div class="custom__redactor-tools-item-container custom__redactor-tools-item-container-rotate">
                                        <input
                                            class="custom__redactor-tools-item-input"
                                            type="number"
                                            v-model="canvas.linkCanvasActive.image.rotate"
                                            @change="updateCanvas()"
                                        >
                                        <input
                                            class="custom__redactor-tools-item-interactive"
                                            type="range"
                                            v-model="canvas.linkCanvasActive.image.rotate"
                                            min="0" max="7" step="0.05" 
                                            @input="updateCanvas()"
                                        >
                                    </div>
                                </div>

                                <div class="custom__redactor-tools-item" v-if="canvas.layers.canvasActive != 0">
                                    <p class="custom__redactor-tools-item-text">Размер</p>
                                    <div class="custom__redactor-tools-item-container custom__redactor-tools-item-container-size">
                                        <div class="custom__redactor-tools-item-container--grid-3">
                                            <input 
                                                class="custom__redactor-tools-item-input" 
                                                type="number" placeholder="Ширина"
                                                v-model="canvas.linkCanvasActive.image.size.width"
                                                @change="updateSize('width')"
                                            >
                                            x
                                            <input 
                                                class="custom__redactor-tools-item-input" 
                                                type="number" placeholder="Высота"
                                                v-model="canvas.linkCanvasActive.image.size.height"
                                                @change="updateSize('height')"
                                            >
                                        </div>

                                        <svg 
                                            class="custom__redactor-tools-item-btn" 
                                            @click="
                                                canvas.toolsChain = canvas.toolsChain ? 0 : canvas.linkCanvasActive.image.size.width/canvas.linkCanvasActive.image.size.height,
                                                stopDragging()
                                            "
                                            :class="{'custom__redactor-tools-item-btn--active': canvas.toolsChain}"
                                        >
                                            <use xlink:href="@/assets/svg/sprite.svg#icon-chain"></use>
                                        </svg>
                                    </div>
                                </div>

                                <div class="custom__redactor-tools-item">
                                    <p class="custom__redactor-tools-item-text">Позиция</p>
                                    <div class="custom__redactor-tools-item-container custom__redactor-tools-item-container-position">
                                        <div class="custom__redactor-tools-item-container--grid-3">
                                            <input 
                                                class="custom__redactor-tools-item-input" 
                                                type="number" placeholder="По ширине"
                                                v-model="canvas.linkCanvasActive.image.position.x"
                                                @change="setItemPosition(), updateCanvas()"
                                            >
                                            x
                                            <input 
                                                class="custom__redactor-tools-item-input" 
                                                type="number" placeholder="По высоте"
                                                v-model="canvas.linkCanvasActive.image.position.y"
                                                @change="setItemPosition(), updateCanvas()"
                                            >
                                        </div>
                                    </div>
                                </div>

                                <div class="custom__redactor-tools-item">
                                    <p class="custom__redactor-tools-item-text">Количество цветов</p>
                                    <div class="custom__redactor-tools-item-container custom__redactor-tools-item-container-position">
                                        <div class="custom__redactor-tools-item-container">
                                            <input 
                                                class="custom__redactor-tools-item-input" 
                                                type="number" placeholder="Количество"
                                                v-model="canvas.colorCount"
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="custom__redactor-canvas-container">
                            <canvas class="custom__redactor-canvas custom__redactor-canvas--top" id="custom-redactor-canvas-border"></canvas>
                            <canvas class="custom__redactor-canvas" id="custom-redactor-canvas-0"></canvas>
                        </div>
                        
                        <svg class="custom__redactor-fullscreen" @click="changeFullscreen">
                            <use xlink:href="@/assets/svg/sprite.svg#icon-fullscreen"></use>
                        </svg>
                    </div>
                </div>
            </section>

            <section class="block catalog">
                <h2 class="block__title">Каталог</h2>

                <div class="catalog__items">
                    <div 
                        class="catalog__item" 
                        v-for="(item, key) in catalogItems" 
                        :key="'market-item-' + item"
                    >
                        <img 
                            class="catalog__item-image"
                            :src="`/images/market/${key}.png`" 
                            :alt="`market-img-${key}`"
                        >

                        <h3 class="catalog__item-title">{{ item.title }}</h3>
                        <p class="catalog__item-desc">{{ item.desc }}</p>
                        <p class="catalog__item-price">От {{ item.price }}&#8381;</p>

                        <button class="catalog__item-btn" @click="changeCatalogItem = key">закастомить</button>
                    </div>
                </div>
            </section>
        </main>
    </div>
</template>
